function apiLoadKifu(e){fileurl="/api/kifu/"+e,debug("api通信：api.kifu param ... "+e),$.ajax({url:fileurl,dataType:"json",success:function(e){debug("--棋譜が読み込まれました"),setMoveList(e)}})}function apiGetKifuInit(e){var t="api/board/";$.ajax({url:t,dataType:"json"}).done(function(t){e(t)}).fail(function(){console.log("apiロードに失敗しました。resource= "+rsh)})}function loadSelectedBoard(){var e=$("#PanelMoveList").children("select").children(":selected"),t=e.attr("data-LastJsCode");if(void 0==e.attr("data-LastJsCode")||void 0==e.attr("data-LastMoveCode"))var o=e.attr("data-RshCurrent");else if("END_OF_GAME"==t){e=e.prev();var o=e.attr("data-RshPrev"),a=e.attr("data-LastJsCode"),s=e.attr("data-LastMoveCode")}else var o=e.attr("data-RshPrev"),a=e.attr("data-LastJsCode"),s=e.attr("data-LastMoveCode");obj={rsh:o,LastJsCode:a,LastMoveCode:s},SetBoardTrigger(obj)}function clearKifu(){var e=$("#PanelMoveList").children("select"),t=e.children();t.remove()}function setKifuWithJson(e){clearKifu(),e=e.json,apiGetKifuInit(function(t){pushKifuNode({RshCurrent:t.Info.RshCurrent,MoveText:"(開始局面)"});for(var o=0,a=e.length;a>o;o++)$("#PanelMoveList").children("select").append($("<option>").html(e[o].MoveText).attr({"data-RshCurrent":e[o].RshCurrent,"data-RshPrev":e[o].RshPrev,"data-LastMoveCode":e[o].LastMoveCode,"data-LastJsCode":e[o].LastJsCode}));selectFirst()})}function pushKifuNode(e){var t=$("<option>").html(e.MoveText).attr({"data-RshCurrent":e.RshCurrent,"data-RshPrev":e.RshPrev,"data-LastJsCode":e.LastJsCode,"data-LastMoveCode":e.LastMoveCode}),o=$("#PanelMoveList").children("select"),a=o.children(":selected");if(0==a.length)$("#PanelMoveList").children("select").append(t),$("#PanelMoveList").children("select").children().prop("selected",!0);else{var s=o.children(":selected").nextAll();s.remove(),a.after(t),a.next().prop("selected",!0)}a.prop("checked",!1)}function selectPrev(){var e=$("#PanelMoveList").children("select"),t=e.children(":selected").prev("option");if(0==t.length)return void console.log("<first>");console.log("<SELECT PREV>");var o=e.children(":selected");o.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}function selectNext(){var e=$("#PanelMoveList").children("select"),t=e.children(":selected").next("option");if(0==t.length)return void console.log("<last>");console.log("<SELECT NEXT>");var o=e.children(":selected");o.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}function selectFirst(){console.log("<SELECT FIRST>");var e=$("#PanelMoveList").children("select").children("input"),t=e.first(),o=e.children(":selected");o.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}function setMoveList(e){for(var t=0,o=e.length;o>t;t++)$("#PanelMoveList").children("select").append($("<option>").html(e[t].MoveText).attr({"data-RshCurrent":e[t].RshCurrent,"data-RshPrev":e[t].RshPrev,"data-LastMoveCode":e[t].LastMoveCode,"data-LastJsCode":e[t].LastJsCode}))}function SetBoardTrigger(e){$("#jsBoard").trigger("setBoard",e)}$(function(){debug("jsKifu/api.jsを読み込みました")}),$(function(){debug("jsKifu/controller.jsを読み込みました"),$("#PanelMoveList").ready(function(){}),$("#PanelMoveList").on("pushKifuNode",function(e,t){pushKifuNode(t)}),$("#PanelMoveList").on("loadKifuWithJson",function(e,t){setKifuWithJson(t)}),$("#PanelMoveList").children("select").change(function(){loadSelectedBoard()}),$("#testNextButton").click(function(){selectNext()}),$("#testPrevButton").click(function(){selectPrev()}),$("html").keyup(function(e){switch(e.which){case 39:selectNext();break;case 37:selectPrev()}})});