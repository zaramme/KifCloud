function apiLoadKifu(e){fileurl="/api/kifu/"+e,debug("api通信：api.kifu param ... "+e),$.ajax({url:fileurl,dataType:"json",success:function(e){debug("--棋譜が読み込まれました"),setMoveList(e)}})}function apiGetKifuInit(e){var t="api/board/";$.ajax({url:t,dataType:"json"}).done(function(t){e(t)}).fail(function(){console.log("apiロードに失敗しました。resource= "+rsh)})}function loadSelectedBoard(){var e=$("#PanelMoveList").children("select").children(":selected"),t=e.attr("data-LastJsCode");if(void 0==e.attr("data-LastJsCode")||void 0==e.attr("data-LastMoveCode"))var a=e.attr("data-RshCurrent");else if("END_OF_GAME"==t)var o=e.prev(),a=o.attr("data-RshPrev"),r=o.attr("data-LastJsCode"),s=o.attr("data-LastMoveCode");else var a=e.attr("data-RshPrev"),r=e.attr("data-LastJsCode"),s=e.attr("data-LastMoveCode");obj={rsh:a,LastJsCode:r,LastMoveCode:s},$(".board").trigger("jbdSetTriangleExist",hasNextorPrev(e)),SetBoardTrigger(obj)}function hasNextorPrev(e){var t={prev:!0,next:!0},a=e.prev("option");0==a.length&&(t.prev=!1);var o=e.next("option");return 0==o.length&&(t.next=!1),t}function clearKifu(){var e=$("#PanelMoveList").children("select"),t=e.children();t.remove()}function setKifuWithJson(e){clearKifu(),e=e.json,apiGetKifuInit(function(t){pushKifuNode({RshCurrent:t.Info.RshCurrent,MoveText:"(開始局面)"});for(var a=0,o=e.length;o>a;a++)$("#PanelMoveList").children("select").append($("<option>").html(e[a].MoveText).attr({"data-RshCurrent":e[a].RshCurrent,"data-RshPrev":e[a].RshPrev,"data-LastMoveCode":e[a].LastMoveCode,"data-LastJsCode":e[a].LastJsCode}));selectFirst()})}function pushKifuNode(e){var t=$("<option>").html(e.MoveText).attr({"data-RshCurrent":e.RshCurrent,"data-RshPrev":e.RshPrev,"data-LastJsCode":e.LastJsCode,"data-LastMoveCode":e.LastMoveCode}),a=$("#PanelMoveList").children("select"),o=a.children(":selected");if(0==o.length)$("#PanelMoveList").children("select").append(t),$("#PanelMoveList").children("select").children().prop("selected",!0);else{var r=a.children(":selected").nextAll();r.remove(),o.after(t),o.prop("selected",!1),o.next().prop("selected",!0)}o=a.children(":selected"),$(".board").trigger("jbdSetTriangleExist",hasNextorPrev(o))}function selectPrev(){var e=$("#PanelMoveList").children("select"),t=e.children(":selected").prev("option");if(0!=t.length){var a=e.children(":selected");a.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}}function selectNext(){var e=$("#PanelMoveList").children("select"),t=e.children(":selected").next("option");if(0!=t.length){var a=e.children(":selected");a.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}}function selectFirst(){var e=$("#PanelMoveList").children("select").children("input"),t=e.first(),a=e.children(":selected");a.prop("selected",!1),t.prop("selected",!0),loadSelectedBoard()}function setMoveList(e){for(var t=0,a=e.length;a>t;t++)$("#PanelMoveList").children("select").append($("<option>").html(e[t].MoveText).attr({"data-RshCurrent":e[t].RshCurrent,"data-RshPrev":e[t].RshPrev,"data-LastMoveCode":e[t].LastMoveCode,"data-LastJsCode":e[t].LastJsCode}))}function SetBoardTrigger(e){$("#jsBoard").trigger("setBoard",e)}$(function(){debug("jsKifu/api.jsを読み込みました")}),$(function(){debug("jsKifu/controller.jsを読み込みました"),$("#PanelMoveList").ready(function(){}),$("#PanelMoveList").children("select").change(function(){loadSelectedBoard()}),$("#PanelMoveList").on("loadKifuWithJson",function(e,t){setKifuWithJson(t)}),$("#PanelMoveList").on("pushKifuNode",function(e,t){pushKifuNode(t)}),$("#PanelMoveList").on("jkfScrollNext",function(e,t){selectNext(t)}),$("#PanelMoveList").on("jkfScrollPrev",function(e,t){selectPrev(t)}),$("html").keyup(function(e){switch(e.which){case 39:selectNext();break;case 37:selectPrev()}})});