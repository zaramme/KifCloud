function apiGetBoardState(e,o,t){var a=API_RSH+"/"+(null===e?"":e)+(null==o?"":"/"+o);$.ajax({url:a,dataType:"json"}).done(function(e){t(e)}).fail(function(){})}function apiGetBoardInfo(e,o,t){var a=API_RSH+"/"+(null===e?"":e)+(null==o?"":"/"+o);$.ajax({url:a,dataType:"json"}).done(function(e){t(e.Info)}).fail(function(){})}function main(){new ctrMethods;$(".board").css("background","url('"+IMG_DIR+"/bg.png')"),$("#bgboard").attr("src",IMG_DIR+"/japanese-chess-b02.png"),$("#jsBoard").on("setBoard",function(e,o){setBoardWithData(o.rsh,o.LastJsCode,o.LastMoveCode)}),$("label#ck-upside-down").on("ifChecked",function(e){UpsideDown.set(!0)}),$("label#ck-upside-down").on("ifUnchecked",function(e){UpsideDown.set(!1)}),initBoard()}function initBoard(){var e=new ctrMethods;document.info.RshPrev.value&&document.info.LastJsCode.value?apiGetBoardState(document.info.RshPrev.value,null,function(o){e.constructBoardFromBoardState(o),doMovePieceFromMoveCode(document.info.LastJsCode.value),refreshClickablePieceSetting(),apiGetBoardInfo(document.info.RshPrev.value,document.info.LastMoveCode.value,function(o){e.setInfo(o),panelReloadTrigger(),o.MoveText="(指定局面)",PushKifuNodeTrigger(o)})}):apiGetBoardState(document.info.RshCurrent.value,null,function(o){e.constructBoardFromBoardState(o),document.info.RshCurrent.value?(o.Info.MoveText="(指定局面)",pushKifuNode(o.Info)):(e.setInfo(o.Info),pushKifuNode({RshCurrent:o.Info.RshCurrent,MoveText:"(初期盤面)"})),panelReloadTrigger()})}function setBoardWithData(e,o,t){var a=new ctrMethods;apiGetBoardState(e,null,function(r){moveAllPieceInDock(),a.constructBoardFromBoardState(r),null!=o&&null!=t?(doMovePieceFromMoveCode(o),refreshClickablePieceSetting(),apiGetBoardInfo(e,t,function(e){a.setInfo(e),panelReloadTrigger()})):(a.setInfo(r.Info),panelReloadTrigger())})}function panelReloadTrigger(){new $.Event("reloadPanel");$(".panel").trigger("reloadPanel")}function PushKifuNodeTrigger(e){$("#PanelMoveList").trigger("pushKifuNode",e)}function refreshClickablePieceSetting(){if($(".draggable").draggable("destroy"),$(".draggable").removeClass("draggable"),!isReserving){var e=new bitBoard;e.eachdo(function(e,o){var t=getPieceObject(e);0!=t.length&&t.hasClass(isBlackTurn?"black":"white")&&addDraggable(t,e)}),CapturedPieces=getCapturedPieces(isBlackTurn),CapturedPieces.each(function(){var e=getPosFromPiece($(this));addDraggable($(this),e)})}}function addDraggable(e,o){e.addClass("draggable"),e.draggable({stack:".piece",revert:!0,containment:"document",distance:0,cursorAt:{top:35,left:30},start:function(){clickPiece(o,e)},stop:function(){endClickPiece(o)}})}function clickPiece(e,o){if(!isReserving){var t=new moveMethods,a=getAreaObject(e),r=new pieceConductor(o),i=new bitBoard;if(i=computeMovable(e,o),i.eachdoSelected(function(e,o){addMovable(e)}),("bc"==e||"wc"==e)&&(CapturedPieces=a.children("."+r.kindOfPiece),CapturedPieces.length>1)){ghost=$("#ghost"),ghost.removeClass("hidden");var s=o.offset();ghost.offset({top:s.top,left:s.left}),t.appendImage(ghost,r.kindOfPiece,r.isBlack,r.isPromoted)}}}function addMovable(e){var o=new ctrMethods,t=getAreaObject(e);t.addClass("movable"),t.droppable({accept:".piece",over:function(){t.addClass("dropin")},out:function(){t.removeClass("dropin")},drop:function(t,a){switch(pieceToMove=a.draggable,fromPos=getPosFromPiece(pieceToMove),res=wheatherPromotable(fromPos,e,pieceToMove),res){case!0:if(doMovePiece(fromPos,e,pieceToMove,!0)){{apiGetBoardInfo(document.info.RshCurrent.value,moveCode,function(e){o.setInfo(e),PushKifuNodeTrigger(e)})}refreshClickablePieceSetting()}break;case"select":ShowReservedView(fromPos,e,pieceToMove);break;case!1:if(doMovePiece(fromPos,e,pieceToMove,!1)){{apiGetBoardInfo(document.info.RshCurrent.value,moveCode,function(e){o.setInfo(e),PushKifuNodeTrigger(e)})}refreshClickablePieceSetting()}break;case"error":}}})}function ShowReservedView(e,o,t){debug("成りセレクトを表示しています");var a=new moveMethods,r=new ctrMethods;pcPiectToMove=new pieceConductor(t),targetPos=getAreaObject(o),targetPiece=getPieceObject(o),selectboxPositionTop=parseInt(targetPos.css("top"))-20,selectboxPositionLeft=parseInt(targetPos.css("left"))-10,$("#selectbox").css("top",selectboxPositionTop),$("#selectbox").css("left",selectboxPositionLeft),isReserving=!0,refreshClickablePieceSetting(),t.addClass("hidden"),targetPiece.addClass("hidden"),ghost=$("#ghost"),ghost.addClass("virtual"),ghost.removeClass("hidden");var i=targetPos.offset();ghost.offset({top:i.top,left:i.left}),a.appendImage(ghost,pcPiectToMove.kindOfPiece,pcPiectToMove.isBlack,pcPiectToMove.isPromoted),$("#selectbox").css("visibility","visible"),$("#selectbox").children(".button").bind("click",function(){var a="promotion"==$(this).attr("id");if(isReserving=!1,t.removeClass("hidden"),targetPiece.removeClass("hidden"),ghost.addClass("hidden"),doMovePiece(e,o,t,a)){{apiGetBoardInfo(document.info.RshCurrent.value,moveCode,function(e){r.setInfo(e),PushKifuNodeTrigger(e)})}$("#selectbox").children(".button").unbind("click"),refreshClickablePieceSetting()}else movePiece(e,t,isBlackTurn,!1),$("#selectbox").children(".button").unbind("click"),$("#selectbox").css("visibility","hidden"),refreshClickablePieceSetting()})}function endClickPiece(e){clickedArea=getAreaObject(e),clickedArea.removeClass("selected"),$(".dropin").removeClass("dropin"),$(".movable").droppable("destroy"),$(".movable").removeClass("movable"),isReserving||($("#ghost").addClass("hidden"),$(".virtual").removeClass("virtual"))}function triangleMethods(){}function doMovePiece(e,o,t,a){var r=new moveMethods,i=getPieceCodeName(t),s=getPieceObject(o);movePiece(o,t,isBlackTurn,a),0!=s.length&&(pcToCapture=new pieceConductor(s),CaptureTo=isBlackTurn?"bc":"wc",movePiece(CaptureTo,s,isBlackTurn,!1));var d=computeIsOhte();return d?(movePiece(e,t,isBlackTurn,a),0!=s.length&&movePiece(pcToCapture.pos,s,!isBlackTurn,pcToCapture.isPromoted),!1):(r.FinishMove(e,o,i,a),!0)}function doMovePieceFromMoveCode(e){var o,t=e.split(",");o="00"==t[0]?getCapturedPieceFirst(isBlackTurn,t[2]):getPieceObject(t[0]);var a="true"==t[3];doMovePiece(t[0],t[1],o,a)}function movePiece(e,o,t,a){{var r=new moveMethods,i=(getPosFromPiece(o),getAreaObject(e));i.children(".piece")}o.prependTo(i).css({top:"0",left:"0"}),r.appendPieceClasses(o,t,a)}function sortCapturedArea(e){if(null==e)return sortCapturedArea("bc"),void sortCapturedArea("wc");var o=new moveMethods,t=$("#pos_"+e);t.children(".piece").removeClass("forefront"),t.children(".piece").removeClass("omitted"),t.children(".test").remove();var a="bc"==e;UpsideDown.getState()&&(a=!a),eachKindOfPieceDo(a,function(e){var o=t.children("."+e),a=!0;o.each(function(){return a?($(this).addClass("forefront"),void(a=!1)):void $(this).addClass("omitted")})}),eachKindOfPieceDo(!a,function(e){t.children("."+e+".forefront").prependTo(t)}),eachKindOfPieceDo(!0,function(e){var a=t.children("."+e),r=t.children("."+e+".forefront").first();o.addPieceCountText(r,a.length)})}function wheatherPromotable(e,o,t){if(toPosY=o%10,fromPosY=e%10,pcPiece=new pieceConductor(t),isEdgeArea=isBlackTurn?1==toPosY:9==toPosY,isSemiEdgeArea=isBlackTurn?toPosY<=2:8<=toPosY,pcPiece.isPromoted)return!0;if(isFromCaptured="bc"==e||"wc"==e,isFromCaptured)return!1;if(isPromotableArea=isBlackTurn?toPosY<=3:7<=toPosY,isFromPromotableArea=isBlackTurn?fromPosY<=3:7<=fromPosY,isPromotableArea)switch(pcPiece.kindOfPiece){case"OH":return!1;case"KIN":return!1;case"KEI":return isSemiEdgeArea?!0:"select";case"KYO":return isEdgeArea?!0:"select";case"FU":return isEdgeArea?!0:"select";default:return"select"}else if(isFromPromotableArea)switch(pcPiece.kindOfPiece){case"OH":return!1;case"KIN":return!1;default:return"select"}return!1}function movePieceFromDock(e,o,t,a){var r=(new moveMethods,getAreaObject(e),$("#pos_dock>.piece:first"));r.addClass(o),movePiece(e,r,t,a)}function moveAllPieceInDock(){methods=new moveMethods;getAreaObject("dock");$(".lastmoved").removeClass("lastmoved");var e=new bitBoard;e.getCurrentPieces(),e.eachdoSelected(function(e,o){var t=(getPieceObject(e),getPieceObject(e));movePiece("dock",t,!1),methods.initPiece(t)});var o=getCapturedPieces();0!=o.length&&o.each(function(){movePiece("dock",$(this),!1),methods.initPiece($(this))})}function moveMethods(){}function computeMovable(e,o){var t=new movableMethods,a=new pieceConductor(o),r=a.isBlack,i=new bitBoard;i.setPointer(e);var s=new triBoard;if(s.getCurrentPieces(isBlackTurn),isCaptured(e))switch(i.allArea(),CurrentBoard=new bitBoard,CurrentBoard.getCurrentPieces(),i.minus(CurrentBoard),a.kindOfPiece){case"FU":t.computeFuDroppable(i,r);break;case"KYO":t.computeKyoDroppable(i,r);break;case"KEI":t.computeKeiDroppable(i,r)}else if(a.isPromoted)switch(a.kindOfPiece){case"FU":t.computeKinMovable(i,r);break;case"GIN":t.computeKinMovable(i,r);break;case"KEI":t.computeKinMovable(i,r);break;case"KYO":t.computeKinMovable(i,r);break;case"KAKU":t.computeRyumaMovable(i,r);break;case"HISHA":t.computeRyuohMovable(i,r);break;default:i.eachdo(function(e,o){i.board[e]=1===s.board[e]?0:1})}else switch(a.kindOfPiece){case"FU":t.computeFuMovable(i,r);break;case"OH":t.computeOhMovable(i,r);break;case"KIN":t.computeKinMovable(i,r);break;case"GIN":t.computeGinMovable(i,r);break;case"KEI":t.computeKeiMovable(i,r);break;case"KYO":t.computeKyoMovable(i,r);break;case"KAKU":t.computeKakuMovable(i,r);break;case"HISHA":t.computeHishaMovable(i,r);break;default:i.eachdo(function(e,o){i.board[e]=1===s.board[e]?0:1})}return isComputing||i.eachdo(function(e,o){1===s.board[e]&&(i.board[e]=0)}),i}function computeIsOhte(){OhPiece=$(isBlackTurn?".OH.black":".OH.white"),OhPos=getPosFromPiece(OhPiece);var e=computeEnemyPower();return 1==e.board[OhPos]}function computeEnemyPower(){var e=new bitBoard;e.getEnemyPieces(),isComputing=!0;var o=new bitBoard;return e.eachdo(function(e,t){if(1==t){var a=new computeMovable(e,getPieceObject(e));o=o.marge(a)}}),isComputing=!1,o}function movableMethods(){}function bitBoard(){for(var e={},o=11;100>o;o++)e[o]=0;this.board=e,this.pointerX=1,this.pointerY=1}function triBoard(){for(var e={},o=11;100>o;o++)e[o]=0;this.board=e}function pieceConductor(e){isNaN(e)?(this.piece=e,this.pos=getPosFromPiece(e)):(this.piece=getPieceObject(e),this.pos=e),this.kindOfPiece=this.getPieceName(this.piece),this.isBlack=this.piece.hasClass("black"),this.isPromoted=this.piece.hasClass("promoted")}function debug(e){}function selectAreaID(e){return"#pos_"+e}function getPieceName(e){return e.hasClass("OH")?"OH":e.hasClass("KIN")?"KIN":e.hasClass("GIN")?"GIN":e.hasClass("KEI")?"KEI":e.hasClass("KYO")?"KYO":e.hasClass("KAKU")?"KAKU":e.hasClass("HISHA")?"HISHA":e.hasClass("FU")?"FU":!1}function getPieceCodeName(e){return e.hasClass("OH")?"OH":e.hasClass("KIN")?"KI":e.hasClass("GIN")?"GI":e.hasClass("KEI")?"KE":e.hasClass("KYO")?"KY":e.hasClass("KAKU")?"KA":e.hasClass("HISHA")?"HI":e.hasClass("FU")?"FU":!1}function getPieceObject(e){return $(selectAreaID(e)).children(".piece")}function getCapturedPieces(e){return null==e?$(".captured").children(".piece"):$(e?"#pos_bc":"#pos_wc").children(".piece")}function getCapturedPieceFirst(e,o){return $(e?"#pos_bc":"#pos_wc").children("."+o).first()}function getAreaObject(e){return $(selectAreaID(e))}function isPieceBlack(e){return CurrentPiece=getPieceObject(e),CurrentPiece.hasClass("black")?!0:CurrentPiece.hasClass("white")?!1:null}function isCaptured(e){return"bc"==e||"wc"==e}function getPosFromPiece(e){return pieceAreaId=e.parent().attr("id"),posID=pieceAreaId.substring(4),posID}function eachKindOfPieceDo(e,o){return e?(o("OH"),o("HISHA"),o("KAKU"),o("KIN"),o("GIN"),o("KEI"),o("KYO"),void o("FU")):(o("FU"),o("KYO"),o("KEI"),o("GIN"),o("KIN"),o("KAKU"),o("HISHA"),void o("OH"))}const HOST="",BOARD_INIT="/board/",BOARD_LOAD="/board/",API_DIR="/api",API_RSH="/api/board",API_MOVE="/api/rsh/",IMG_DIR="/public/img/jsBoard";$(function(){main()});var ctrMethods=function(){};ctrMethods.prototype.constructBoardFromBoardState=function(e){isBlackTurn=e.Turn;for(objName in e.Pieces){var o=e.Pieces[objName],t=o.Pos,a=o.Kop,r=o.Ply,i=o.IsPrm;0==t&&r?t="bc":0!=t||r||(t="wc"),movePieceFromDock(t,a,r,i)}sortCapturedArea(),IsBoardInit=!0,refreshClickablePieceSetting()},ctrMethods.prototype.setInfo=function(e){document.info.RshCurrent.value=e.RshCurrent,document.info.RshPrev.value=e.RshPrev,document.info.LastMoveCode.value=e.LastMoveCode,document.info.LastJsCode.value=e.LastJsCode,document.info.MoveText.value=e.MoveText,panelReloadTrigger()},$(function(){$(".board").children(".tri-prev").hover(function(){$(this).css("border-right-color","rgba(211,84,0,0.6)")},function(){$(this).css("border-right-color","#dddddd")}).mousedown(function(e){$(this).css("border-right-color","#dddddd")}).click(function(e){$("#PanelMoveList").trigger("jkfScrollPrev")}).mouseup(function(e){$(this).css("border-right-color","rgba(211,84,0,0.6)")}),$(".board").children(".tri-next").hover(function(){$(this).css("border-left-color","rgba(211,84,0,0.6)")},function(){$(this).css("border-left-color","#dddddd")}).click(function(e){$("#PanelMoveList").trigger("jkfScrollNext")}).mousedown(function(e){$(this).css("border-left-color","#dddddd")}).mouseup(function(e){$(this).css("border-left-color","rgba(211,84,0,0.6)")}),$(".board").on("jbdSetTriangleExist",function(e,o){var t=new triangleMethods;t.setExist(o)})}),triangleMethods.prototype.setExist=function(e){1==e.prev&&$(".board").children(".tri-prev").show(),0==e.prev&&$(".board").children(".tri-prev").hide(),1==e.next&&$(".board").children(".tri-next").show(),0==e.next&&$(".board").children(".tri-next").hide()},moveMethods.prototype.clearPieceClasses=function(e){var o=function(o){e.hasClass(o)&&e.removeClass(o)};o("white"),o("black"),o("promoted"),o("omitted"),o("forefront")},moveMethods.prototype.initPiece=function(e){this.clearPieceClasses(e),eachKindOfPieceDo(!0,function(o){e.hasClass(o)&&e.removeClass(o)})},moveMethods.prototype.appendPieceClasses=function(e,o,t){kindOfPiece=getPieceName(e),this.clearPieceClasses(e),t&&e.addClass("promoted"),e.addClass(o?"black":"white"),this.appendImage(e,kindOfPiece,o,t)},moveMethods.prototype.appendImage=function(e,o,t,a){imgID=this.createImageID(o,t,a),e.children("img").attr("src",IMG_DIR+"/"+imgID+".png")},moveMethods.prototype.addPieceCountText=function(e,o){e.after(o>1?'<div class="test"><div class="piece-count">×'+o+"</div></div>":'<div class="test"></div>')},moveMethods.prototype.createImageID=function(e,o,t){var a=new String;switch(a+=o?PieceImageCode.black:PieceImageCode.white,t&&(a+=PieceImageCode.promoted),UpsideDown.getState()&&(a+=PieceImageCode.upsideDown),e){case PieceImageCode.OH:a+=PieceImageCode.OH;break;case PieceImageCode.KIN:a+=PieceImageCode.KIN;break;case PieceImageCode.GIN:a+=PieceImageCode.GIN;break;case PieceImageCode.KEI:a+=PieceImageCode.KEI;break;case PieceImageCode.KYO:a+=PieceImageCode.KYO;break;case PieceImageCode.KAKU:a+=PieceImageCode.KAKU;break;case PieceImageCode.HISHA:a+=PieceImageCode.HISHA;break;case PieceImageCode.FU:a+=PieceImageCode.FU}return a},moveMethods.prototype.FinishMove=function(e,o,t,a){moveCode=this.getMovecode(e,o,t,a),isBlackTurn=!isBlackTurn,isOhte=computeIsOhte(),$(".lastmoved").removeClass("lastmoved");var r=getAreaObject(o);r.addClass("lastmoved"),$("#selectbox").css("visibility","hidden"),sortCapturedArea()},moveMethods.prototype.getMovecode=function(e,o,t,a){var r;return r=isBlackTurn?"b":"w",r+=o,r+=t,("bc"==e||"wc"==e)&&(e="00"),r=r+"_"+e,a&&(r+="!"),r},movableMethods.prototype.computeOhMovable=function(e,o){if(e.addArea(-1,1,o),e.addArea(0,1,o),e.addArea(1,1,o),e.addArea(-1,0,o),e.addArea(1,0,o),e.addArea(-1,-1,o),e.addArea(0,-1,o),e.addArea(1,-1,o),!isComputing){var t=new bitBoard;t=computeEnemyPower(),e.minus(t)}},movableMethods.prototype.computeKinMovable=function(e,o){e.addArea(-1,1,o),e.addArea(0,1,o),e.addArea(1,1,o),e.addArea(-1,0,o),e.addArea(1,0,o),e.addArea(0,-1,o)},movableMethods.prototype.computeGinMovable=function(e,o){e.addArea(-1,1,o),e.addArea(0,1,o),e.addArea(1,1,o),e.addArea(-1,-1,o),e.addArea(1,-1,o)},movableMethods.prototype.computeKeiMovable=function(e,o){e.addArea(-1,2,o),e.addArea(1,2,o)},movableMethods.prototype.computeKyoMovable=function(e,o){e.addStraightArea(0,1,o)},movableMethods.prototype.computeKakuMovable=function(e,o){e.addStraightArea(1,1,o),e.addStraightArea(-1,1,o),e.addStraightArea(-1,-1,o),e.addStraightArea(1,-1,o)},movableMethods.prototype.computeHishaMovable=function(e,o){e.addStraightArea(0,1,o),e.addStraightArea(1,0,o),e.addStraightArea(0,-1,o),e.addStraightArea(-1,0,o)},movableMethods.prototype.computeFuMovable=function(e,o){e.addArea(0,1,o)},movableMethods.prototype.computeRyumaMovable=function(e,o){e.addStraightArea(1,1,o),e.addStraightArea(-1,1,o),e.addStraightArea(-1,-1,o),e.addStraightArea(1,-1,o),e.addArea(0,1,o),e.addArea(-1,0,o),e.addArea(1,0,o),e.addArea(0,-1,o)},movableMethods.prototype.computeRyuohMovable=function(e,o){e.addStraightArea(0,1,o),e.addStraightArea(1,0,o),e.addStraightArea(0,-1,o),e.addStraightArea(-1,0,o),e.addArea(-1,1,o),e.addArea(1,1,o),e.addArea(-1,-1,o),e.addArea(1,-1,o)},movableMethods.prototype.computeFuDroppable=function(e,o){for(var t=new bitBoard,a=11;100>a;a++){var r=getPieceObject(a);if(0!=r.length){var i=new pieceConductor(r);"FU"!=getPieceName(r)||isBlackTurn!=i.isBlack||i.isPromoted||t.addColumnArea(Math.floor(a/10))}}var s=new bitBoard;s.addRowArea(isBlackTurn?1:9),e.minus(t),e.minus(s)},movableMethods.prototype.computeKeiDroppable=function(e,o){rowsBoard=new bitBoard,rowsBoard.addRowArea(isBlackTurn?1:9),rowsBoard.addRowArea(isBlackTurn?2:8),e.minus(rowsBoard)},movableMethods.prototype.computeKyoDroppable=function(e,o){rowsBoard=new bitBoard,rowsBoard.addRowArea(isBlackTurn?1:9),e.minus(rowsBoard)},$(function(){debug("bitBoard.jsを読み込みました")}),bitBoard.prototype.output=function(){debug(this.board[91]+", "+this.board[81]+", "+this.board[71]+", "+this.board[61]+", "+this.board[51]+", "+this.board[41]+", "+this.board[31]+", "+this.board[21]+", "+this.board[11]),debug(this.board[92]+", "+this.board[82]+", "+this.board[72]+", "+this.board[62]+", "+this.board[52]+", "+this.board[42]+", "+this.board[32]+", "+this.board[22]+", "+this.board[12]),debug(this.board[93]+", "+this.board[83]+", "+this.board[73]+", "+this.board[63]+", "+this.board[53]+", "+this.board[43]+", "+this.board[33]+", "+this.board[23]+", "+this.board[13]),debug(this.board[94]+", "+this.board[84]+", "+this.board[74]+", "+this.board[64]+", "+this.board[54]+", "+this.board[44]+", "+this.board[34]+", "+this.board[24]+", "+this.board[14]),debug(this.board[95]+", "+this.board[85]+", "+this.board[75]+", "+this.board[65]+", "+this.board[55]+", "+this.board[45]+", "+this.board[35]+", "+this.board[25]+", "+this.board[15]),debug(this.board[96]+", "+this.board[86]+", "+this.board[76]+", "+this.board[66]+", "+this.board[56]+", "+this.board[46]+", "+this.board[36]+", "+this.board[26]+", "+this.board[16]),debug(this.board[97]+", "+this.board[87]+", "+this.board[77]+", "+this.board[67]+", "+this.board[57]+", "+this.board[47]+", "+this.board[37]+", "+this.board[27]+", "+this.board[17]),debug(this.board[98]+", "+this.board[88]+", "+this.board[78]+", "+this.board[68]+", "+this.board[58]+", "+this.board[48]+", "+this.board[38]+", "+this.board[28]+", "+this.board[18]),debug(this.board[99]+", "+this.board[89]+", "+this.board[79]+", "+this.board[69]+", "+this.board[59]+", "+this.board[49]+", "+this.board[39]+", "+this.board[29]+", "+this.board[19]),debug("")},bitBoard.prototype.eachdo=function(e){for(var o=11;100>o;o++)e(o,this.board[o])},bitBoard.prototype.eachdoSelected=function(e){for(var o=11;100>o;o++)1==this.board[o]&&e(o,this.board[o])},bitBoard.prototype.allArea=function(){for(var e=11;100>e;e++)this.board[e]=1},bitBoard.prototype.getCurrentPieces=function(){for(var e=11;100>e;e++){var o=getAreaObject(e),t=o.children(".piece");0!=t.length&&(this.board[e]=1)}},bitBoard.prototype.getAllMovable=function(e){for(var o=11;100>o;o++){var t=getAreaObject(o),a=t.children(".piece");(0==a.length||a.hasClass(e?"white":"black"))&&(this.board[o]=1)}},bitBoard.prototype.getEnemyPieces=function(){for(var e=11;100>e;e++){var o=getPieceObject(e);0!=o.length&&o.hasClass(isBlackTurn?"white":"black")&&(this.board[e]=1)}},bitBoard.prototype.setPointer=function(e){this.pointerX=Math.floor(e/10),this.pointerY=e%10},bitBoard.prototype.addArea=function(e,o,t){var a=this.pointerX,r=this.pointerY;t?o=-1*o:e=-1*e,a=this.pointerX+e,r=this.pointerY+o,this.isPositionInBoard(a,r)&&(this.board[this.getPosXY(a,r)]=1)},bitBoard.prototype.addStraightArea=function(e,o,t){var a=new bitBoard;a.getCurrentPieces(),t?o=-1*o:e=-1*e;for(var r=this.pointerX+e,i=this.pointerY+o;this.isPositionInBoard(r,i);){var s=this.getPosXY(r,i);if(this.board[s]=1,1===a.board[s])break;r+=e,i+=o}},bitBoard.prototype.addColumnArea=function(e){for(var o=11;100>o;o++)Math.floor(o/10)==e&&(this.board[o]=1)},bitBoard.prototype.addRowArea=function(e){for(var o=11;100>o;o++)o%10==e&&(this.board[o]=1)},bitBoard.prototype.isPositionInBoard=function(e,o){return 1>e||e>9?!1:1>o||o>9?!1:!0},bitBoard.prototype.getPosXY=function(e,o){return 10*e+o},bitBoard.prototype.marge=function(e){var o=this;return this.eachdo(function(t,a){1==e.board[t]&&(o.board[t]=1)}),o},bitBoard.prototype.minus=function(e){var o=this;return this.eachdo(function(t,a){1==e.board[t]&&(o.board[t]=0)}),o},$(function(){debug("triBoard.jsを読み込みました")}),triBoard.prototype.output=function(){debug("current triBoard is..."),debug(this.board[91]+", "+this.board[81]+", "+this.board[71]+", "+this.board[61]+", "+this.board[51]+", "+this.board[41]+", "+this.board[31]+", "+this.board[21]+", "+this.board[11]),debug(this.board[92]+", "+this.board[82]+", "+this.board[72]+", "+this.board[62]+", "+this.board[52]+", "+this.board[42]+", "+this.board[32]+", "+this.board[22]+", "+this.board[12]),debug(this.board[93]+", "+this.board[83]+", "+this.board[73]+", "+this.board[63]+", "+this.board[53]+", "+this.board[43]+", "+this.board[33]+", "+this.board[23]+", "+this.board[13]),debug(this.board[94]+", "+this.board[84]+", "+this.board[74]+", "+this.board[64]+", "+this.board[54]+", "+this.board[44]+", "+this.board[34]+", "+this.board[24]+", "+this.board[14]),debug(this.board[95]+", "+this.board[85]+", "+this.board[75]+", "+this.board[65]+", "+this.board[55]+", "+this.board[45]+", "+this.board[35]+", "+this.board[25]+", "+this.board[15]),debug(this.board[96]+", "+this.board[86]+", "+this.board[76]+", "+this.board[66]+", "+this.board[56]+", "+this.board[46]+", "+this.board[36]+", "+this.board[26]+", "+this.board[16]),debug(this.board[97]+", "+this.board[87]+", "+this.board[77]+", "+this.board[67]+", "+this.board[57]+", "+this.board[47]+", "+this.board[37]+", "+this.board[27]+", "+this.board[17]),debug(this.board[98]+", "+this.board[88]+", "+this.board[78]+", "+this.board[68]+", "+this.board[58]+", "+this.board[48]+", "+this.board[38]+", "+this.board[28]+", "+this.board[18]),debug(this.board[99]+", "+this.board[89]+", "+this.board[79]+", "+this.board[69]+", "+this.board[59]+", "+this.board[49]+", "+this.board[39]+", "+this.board[29]+", "+this.board[19]),debug("")},triBoard.prototype.eachdo=function(e){for(var o=11;100>o;o++)e(o,this.board[o])},triBoard.prototype.getCurrentPieces=function(e){for(var o=11;100>o;o++){var t=getAreaObject(o),a=t.children(".piece");0!==a.length?a.hasClass("black")?this.board[o]=e?1:2:a.hasClass("white")?this.board[o]=e?2:1:debug("ERROR...getCurrentPiece"):this.board[o]=0}},$(function(){debug("pieceStates.jsを読み込みました")}),pieceConductor.prototype.setPieceBlackWhite=function(e){},pieceConductor.prototype.appendPieceClasses=function(e,o){this.isBlack=e,this.isPromoted=o,this.clearPieceClasses(),o&&this.piece.addClass("promoted"),this.piece.addClass(e?"black":"white"),this.appendImage()},pieceConductor.prototype.clearPieceClasses=function(){this.piece.hasClass("promoted")&&this.piece.removeClass("promoted"),this.piece.hasClass("white")&&this.piece.removeClass("white"),this.piece.hasClass("black")&&this.piece.removeClass("black")},pieceConductor.prototype.appendImage=function(){imgID=this.createImageID(),this.piece.children("img").attr("src",IMG_DIR+imgID+".png")},pieceConductor.prototype.createImageID=function(){var e=new String;switch(this.kindOfPiece){case PieceImageCode.OH:e+=PieceImageCode.OH;break;case PieceImageCode.KIN:e+=PieceImageCode.KIN;break;case PieceImageCode.GIN:e+=PieceImageCode.GIN;break;case PieceImageCode.KEI:e+=PieceImageCode.KEI;break;case PieceImageCode.KYO:e+=PieceImageCode.KYO;break;case PieceImageCode.KAKU:e+=PieceImageCode.KAKU;break;case PieceImageCode.HISHA:e+=PieceImageCode.HISHA;break;case PieceImageCode.FU:e+=PieceImageCode.FU}return(!this.isBlack&&UpsideDown.get()||this.isBlack&&!UpsideDown.get())&&(e+=PieceImageCode.reverse),isPromoted&&(e+=PieceImageCode.promoted),e},pieceConductor.prototype.output=function(){console.log("駒の種類…"+this.kindOfPiece+", 駒の所有…"+this.isBlack+", 駒の成り…"+this.isPromoted)},pieceConductor.prototype.selectAreaID=function(e){return"#pos_"+e},pieceConductor.prototype.getPieceObject=function(e){return target=$(this.selectAreaID(e)).children("piece"),debug(target.length),$(this.selectAreaID(e)).children("piece")},pieceConductor.prototype.getAreaObject=function(e){return $(this.selectAreaID(e))},pieceConductor.prototype.getPieceName=function(e){return e.hasClass("OH")?"OH":e.hasClass("KIN")?"KIN":e.hasClass("GIN")?"GIN":e.hasClass("KEI")?"KEI":e.hasClass("KYO")?"KYO":e.hasClass("KAKU")?"KAKU":e.hasClass("HISHA")?"HISHA":e.hasClass("FU")?"FU":!1},IsDebugMode=!0,$(function(){debug("utility.jsを読み込みました")}),$(function(){debug("define.jsを読み込みました")});var isBlackTurn=!0,isComputing=!1,isReserving=!1,ReservingCount,isOhte=!1,reservedPos=0;PieceImageCode=new Object,PieceImageCode.black="black/",PieceImageCode.white="white/",PieceImageCode.OH="OH",PieceImageCode.KIN="KIN",PieceImageCode.GIN="GIN",PieceImageCode.KEI="KEI",PieceImageCode.KYO="KYO",PieceImageCode.KAKU="KAKU",PieceImageCode.HISHA="HISHA",PieceImageCode.FU="FU",PieceImageCode.separator="_",PieceImageCode.reverse="r",PieceImageCode.promoted="promoted/",PieceImageCode.upsideDown="upside_down/";const OH=0,KIN=1,GIN=2,KEI=3,KYO=4,KAKU=5,HISHA=6,FU=7,BLACK=!1,WHITE=!1,hasBlackPiece=0,hasWhitePiece=1,none=null;var UpsideDown=function(){var e=!1,o=function(o){if(o!=e){var r=$(".board > .onboard");e=o,console.log("setUpdside = "+e),r.each(function(){a($(this))});var i=new moveMethods,s=$(".piece");s.each(function(){var e=new pieceConductor($(this));i.appendImage($(this),e.kindOfPiece,e.isBlack,e.isPromoted)}),t(o),sortCapturedArea(null),o?($("#pos_bc").addClass("wc").removeClass("bc"),$("#pos_wc").addClass("bc").removeClass("wc")):($("#pos_bc").addClass("bc").removeClass("wc"),$("#pos_wc").addClass("wc").removeClass("bc"))}},t=function(e){e?$(".board").css("background","url('"+IMG_DIR+"/bg_u.png')"):$(".board").css("background","url('"+IMG_DIR+"/bg.png')")},a=function(o){if(1!=o.length)return!1;var t=o.attr("id").charAt(4),a=o.attr("id").charAt(5);if(isNaN(t)||isNaN(a))return!1;var i=r(t),s=r(a);return e?(o.removeClass("x"+t),o.removeClass("y"+a),o.addClass("x"+i),o.addClass("y"+s)):(o.removeClass("x"+i),o.removeClass("y"+s),o.addClass("x"+t),o.addClass("y"+a)),!0},r=function(e){return e-2*(e-5)};return{getState:function(){return e},set:function(e){o(e)}}}();